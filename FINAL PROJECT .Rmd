---
title: "Final project"
author: Avery Harff 
output: html_document
date: "2024-02-27"
---
 Question: The goal is to analyze how the Bombus Vosnesenkii interacts with different plants across Oregon in varying temperatures, climates (wet/ dry season), and altitude. 
 
```{r}
library(tidyverse)
library(bipartite)
library(terra)
library(ggplot2)
library(dplyr)
library(raster)
library(sf)
library(readxl)
library(lubridate)
```

What are the tip 5 most abundant bee species and most visited flower species in the top 5 biggest cities in Oregon? April-September 

Does the Min or max temperature for each month in each city affect the number of bee species or flower species observed?

Top 5 cities in Oregon
1 - Portland 
2 - Eugene
3 - Salem
4 - medford
5 - bend

ouline of eugene
```{r}
#shapefiles of the boundries of the five major cities

portland <- read_sf("/Users/averyharff/Downloads/portland/City_Boundaries.shp")


eugene <- read_sf("/Users/averyharff/Downloads/Eugene_Zoning___Hub_-8431398599973602668/Eugene_Zoning.shp")
eugene_vect <- vect(eugene)

salem <- read_sf("/Users/averyharff/Downloads/CityLimits/CityLimits.shp")

medford <- read_sf("/Users/averyharff/Downloads/medfordCity_Limits (1)/City_Limits.shp")

bend <- read_sf("/Users/averyharff/Downloads/bend/Zoning.shp")
```
Dataframe of city, year, month, bee and plant
```{r}
OBA <- read_excel("~/Downloads/OBA_2018-2023_Ponisio.xlsx")
OBA$Year <- OBA$`Year 1`

```

```{r}
## data cleaning, removing all the spaces commas and periods not needed
OBA$`Abbreviated Location` <- trimws(OBA$`Abbreviated Location`)
OBA$`Abbreviated Location` <- sub(" .*", "", OBA$`Abbreviated Location`)
OBA$`Abbreviated Location` <- sub(",$","", OBA$`Abbreviated Location`)
```

```{r}
#making dataframe using filter 

years <- c("2018", "2019")
cities <- c("Eugene", "Portland", "Salem", "Medford", "Bend")
month <- c("April", "May", "June", "July", "August", "September")
OBA18_19 <- OBA %>% 
  filter(Year %in% years) %>%
  filter(`Abbreviated Location` %in% cities) %>% ## %in% telling filter to only use what is in the list 
  filter(MonthJul %in% month)

OBA18_19 <- OBA18_19[c("Dec. Long.", "Dec. Lat.","Abbreviated Location", "MonthJul", "Year 1", "Associated plant", "Species")]

bee_plant_count <- OBA18_19 %>%  count(Species, `Associated plant`)

```


```{r}
#dont have to load until plot 
minTemp18 <- rast("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil")

maxtemp18 <- rast("/Users/averyharff/Desktop/18MaxPPRISM_tmax_stable_4kmM3_2018_all_bil/PRISM_tmax_stable_4kmM3_2018_bil.bil")

mintemp19 <- rast("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil")

maxtemp19 <- rast("/Users/averyharff/Desktop/MAXTEMP19PRISM_tmax_stable_4kmM3_2019_all_bil/PRISM_tmax_stable_4kmM3_2019_bil.bil")

```

```{r}
#function will load in rasterfile and city shape file name, then crop raster to the city shape file, return to temp average for city 
cropped_tempCity <- function(rasterfilename_min, rasterfilename_max,  cityfilename){
                    out_min <- terra::extract(x = rasterfilename_min, y = cityfilename,
                                fun = mean)
                     out_max <- terra::extract(x = rasterfilename_max, y = cityfilename,
                                fun = mean)
                    return(c(min=out_min[,2], max=out_max[,2]))
}

#loading in data for min and max temperatures of portland. 
temp2018_eugene <- cropped_tempCity(minTemp18, maxtemp18, eugene_vect)

min2019_Portland <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil", "/Users/averyharff/Downloads/portland/City_Boundaries.shp")

max2019_Portland <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil", "/Users/averyharff/Downloads/portland/City_Boundaries.shp")
```

```{r}
min2018_Eugene <- cropped_tempCity("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil", "/Users/averyharff/Downloads/Eugene_Zoning___Hub_-8431398599973602668/Eugene_Zoning.shp")

max2018_Eugene <- cropped_tempCity("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil", "/Users/averyharff/Downloads/Eugene_Zoning___Hub_-8431398599973602668/Eugene_Zoning.shp")

min2019_Eugene <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil", "/Users/averyharff/Downloads/Eugene_Zoning___Hub_-8431398599973602668/Eugene_Zoning.shp")

max2019_Eugene <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil", "/Users/averyharff/Downloads/Eugene_Zoning___Hub_-8431398599973602668/Eugene_Zoning.shp")

min18_Bend <- cropped_tempCity("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil", "/Users/averyharff/Downloads/bend/Zoning.shp")

max18_Bend <- cropped_tempCity("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil","/Users/averyharff/Downloads/bend/Zoning.shp")

min19_Bend <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil","/Users/averyharff/Downloads/bend/Zoning.shp")

max19_Bend <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil","/Users/averyharff/Downloads/bend/Zoning.shp")

min18_salem <- cropped_tempCity("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil", "/Users/averyharff/Downloads/CityLimits/CityLimits.shp")

max18_salem <- cropped_tempCity("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil","/Users/averyharff/Downloads/CityLimits/CityLimits.shp")

min19_salem <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil","/Users/averyharff/Downloads/CityLimits/CityLimits.shp")

max19_salem <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil","/Users/averyharff/Downloads/CityLimits/CityLimits.shp")

min18_medford <- cropped_tempCity("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil", "/Users/averyharff/Downloads/medfordCity_Limits (1)/City_Limits.shp")

max18_medford <- cropped_tempCity("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil", "/Users/averyharff/Downloads/medfordCity_Limits (1)/City_Limits.shp")

min19_medford <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil","/Users/averyharff/Downloads/medfordCity_Limits (1)/City_Limits.shp")

max19_medford <- cropped_tempCity("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil","/Users/averyharff/Downloads/medfordCity_Limits (1)/City_Limits.shp")
```

turn all cities into one list, make a four loop for each element of list use function created uptop. it will extract values from eugene and salem. return(give me back a table with max and min temp of each city) one for 18 one for 19. use city as uniting code for the table 
```{r}

```

```{r}
 
```

```{r}

```

```{r}

```


```{r}

```


graph the average precipitation levels in 2019 and 2018 in Oregon (scatterplot, continuouslty, color points by season)
```{r}
Oregon Prism website has data or 
https://www.arcgis.com/home/item.html?id=dab2424ee1d9472ab126a771aa334990

rain_levels <- read_xml()
```

sort bee plant and bee data into columns of rows of the post popular bees and plants. use a network for the plants and the city.  
```{r}


```

make a table of the most popular cities (5) and plot the year month max temp, min temp, # bee species, # flower species
```{r}

```

raster - oregon prism
```{r}

```
oba - point data
city -  spacial
```{r}

```
plant - network
```{r}

```


```{r}

```













