---
title: "Final project"
author: Avery Harff 
output: html_document
date: "2024-02-27"
---
 Question: The goal is to analyze how the Bombus Vosnesenkii interacts with different plants across Oregon in varying temperatures, climates (wet/ dry season), and altitude. 
 
```{r}
library(tidyverse)
library(bipartite)
library(terra)
library(ggplot2)
library(dplyr)
library(raster)
library(sf)
library(readxl)
library(lubridate)
```

What are the tip 5 most abundant bee species and most visited flower species in the top 5 biggest cities in Oregon? April-September 

Does the Min or max temperature for each month in each city affect the number of bee species or flower species observed?

Top 5 cities in Oregon
1 - Portland 
2 - Eugene
3 - Salem
4 - medford
5 - bend

ouline of eugene
```{r}
#shapefiles of the boundries of the five major cities

portland <- read_sf("/Users/averyharff/Downloads/portland/City_Boundaries.shp")
portland_vect <- vect(portland)

eugene <- read_sf("/Users/averyharff/Downloads/Eugene_Zoning___Hub_-8431398599973602668/Eugene_Zoning.shp")
eugene_vect <- vect(eugene)

salem <- read_sf("/Users/averyharff/Downloads/CityLimits/CityLimits.shp")
salem_vect <- vect(salem)

medford <- read_sf("/Users/averyharff/Downloads/medfordCity_Limits (1)/City_Limits.shp")
medford_vect <- vect(medford)

bend <- read_sf("/Users/averyharff/Downloads/bend/Zoning.shp")
bend_vect <- vect(bend)
```
Dataframe of city, year, month, bee and plant
```{r}
OBA <- read_excel("~/Downloads/OBA_2018-2023_Ponisio.xlsx")
OBA$Year <- OBA$`Year 1`

```

```{r}
## data cleaning, removing all the spaces commas and periods not needed
OBA$`Abbreviated Location` <- trimws(OBA$`Abbreviated Location`)
OBA$`Abbreviated Location` <- sub(" .*", "", OBA$`Abbreviated Location`)
OBA$`Abbreviated Location` <- sub(",$","", OBA$`Abbreviated Location`)
```

```{r}
#dont have to load until plot 
minTemp18 <- rast("/Users/averyharff/Desktop/18TEMPMINPRISM_tmin_stable_4kmM3_2018_all_bil/PRISM_tmin_stable_4kmM3_2018_bil.bil")

maxtemp18 <- rast("/Users/averyharff/Desktop/18MaxPPRISM_tmax_stable_4kmM3_2018_all_bil/PRISM_tmax_stable_4kmM3_2018_bil.bil")

mintemp19 <- rast("/Users/averyharff/Desktop/19MINPRISM_tmin_stable_4kmM3_2019_all_bil/PRISM_tmin_stable_4kmM3_2019_bil.bil")

maxtemp19 <- rast("/Users/averyharff/Desktop/MAXTEMP19PRISM_tmax_stable_4kmM3_2019_all_bil/PRISM_tmax_stable_4kmM3_2019_bil.bil")

```

```{r}
#function will load in rasterfile and city shape file name, then crop raster to the city shape file, return to temp average for city 
cropped_tempCity <- function(rasterfilename_min, rasterfilename_max,  cityfilename){
                    out_min <- terra::extract(x = rasterfilename_min, y = cityfilename,
                                fun = mean)
                     out_max <- terra::extract(x = rasterfilename_max, y = cityfilename,
                                fun = mean)
                    return(c(min=out_min[,2], max=out_max[,2]))
}

#loading in data for min and max temperatures of portland. 
eugene18 <- cropped_tempCity(minTemp18, maxtemp18, eugene_vect)

eugene19 <- cropped_tempCity(mintemp19, maxtemp19, eugene_vect)

portland18 <- cropped_tempCity(minTemp18, maxtemp18, portland_vect)

portland19 <- cropped_tempCity(mintemp19, maxtemp19, portland_vect)

salem18 <- cropped_tempCity(minTemp18, maxtemp18, salem_vect)

salem19 <- cropped_tempCity(mintemp19, maxtemp19, salem_vect)

bend18 <- cropped_tempCity(minTemp18, maxtemp18, bend_vect)

bend19 <- cropped_tempCity(mintemp19, maxtemp19, bend_vect)

medford18 <- cropped_tempCity(minTemp18, maxtemp18, medford_vect)

medford19 <- cropped_tempCity(mintemp19, maxtemp19, medford_vect)

```

turn all cities into one list, make a four loop for each element of list use function created uptop. it will extract values from eugene and salem. return(give me back a table with max and min temp of each city) one for 18 one for 19. use city as uniting code for the table 
```{r}
#merge shape files for each city to one df have a column called year. create column for all files. create a function 
#changing portlands CRS to match the rest of the cities 


portland <- st_transform(portland, crs = st_crs(eugene))

# Define the function
convert_to_dataframe <- function(x) {
  
  combined_vector <- unlist(x)
  # Find the minimum and maximum values in the combined vector
  minTemp <- min(combined_vector)
  maxTemp <- max(combined_vector)
  
  # Create a data frame with up to three columns
  df <- data.frame(minTemp, maxTemp)
  colnames(df) <- c("MinTemp", "MaxTemp")
  
  
  return(df)
}
#Df of min and max temp of the city
Bend18DF <- convert_to_dataframe(bend18)
Bend19DF <- convert_to_dataframe(bend19)
eugene18DF <- convert_to_dataframe(eugene18)
eugene19DF <- convert_to_dataframe(eugene19)
salem18DF <- convert_to_dataframe(salem18)
salem19DF <- convert_to_dataframe(salem19)
medford18DF <- convert_to_dataframe(medford18)
medford19DF <- convert_to_dataframe(medford19)
portland18DF <- convert_to_dataframe(portland18)
portland19DF <- convert_to_dataframe(portland19)

#merge all together
merged <- merge(Bend18DF, Bend19DF, by = c('MinTemp', 'MaxTemp'))

cityDF <- rbind(Bend18DF, Bend19DF, eugene18DF, eugene19DF, salem18DF, salem19DF, medford18DF, medford19DF, portland18DF, portland19DF)

City <- c("Bend", "Bend", "Eugene", "Eugene", "Salem", "Salem", "Medford", "Medford", "Portland", "Portland")
Year <- c("2018", "2019", "2018", "2019", "2018", "2019", "2018", "2019", "2018", "2019")

rm(cityDF)

cityDF <- cbind(City, Year, cityDF)
cityDF$city_year <- paste(cityDF$City, cityDF$Year, sep = "_")
#made table with city max and min temps 
```

```{r}
# big table 
years <- c("2018", "2019")
cities <- c("Eugene", "Portland", "Salem", "Medford", "Bend")
#month <- c("April", "May", "June", "July", "August", "September")
OBA18_19 <- OBA %>% 
  filter(Year %in% years) %>%
  filter(`Abbreviated Location` %in% cities) #%in% telling filter to only use what is in the list 
OBA18_19$city_year <- paste(OBA18_19$`Abbreviated Location`, OBA18_19$`Year 1`, sep = "_")
  #filter(MonthJul %in% month)

OBA18_19 <- OBA18_19[c("Dec. Long.", "Dec. Lat.","Abbreviated Location", "MonthJul", "Year 1", "Associated plant", "Species")]

complete_data<- merge(OBA18_19, cityDF, by = "city_year")

bee_plant_count <- OBA18_19 %>%  count(Species, `Associated plant`)
```

```{r}
#making rowsum for bees and plants 
landing_count <- table(OBA18_19$Species, OBA18_19$`Associated plant`)

landing_table <- as.data.frame.matrix(landing_count)

sortedTable <- landing_table[order(rowSums(landing_count), decreasing = TRUE), ]


```


```{r}

```


graph the average precipitation levels in 2019 and 2018 in Oregon (scatterplot, continuouslty, color points by season)
```{r}
Oregon Prism website has data or 
https://www.arcgis.com/home/item.html?id=dab2424ee1d9472ab126a771aa334990

rain_levels <- read_xml()
```

sort bee plant and bee data into columns of rows of the post popular bees and plants. use a network for the plants and the city.  
```{r}


```

make a table of the most popular cities (5) and plot the year month max temp, min temp, # bee species, # flower species
```{r}

```

raster - oregon prism
```{r}

```
oba - point data
city -  spacial
```{r}

```
plant - network
```{r}

```


```{r}

```













